<?php

namespace Tests\Feature;

use App\Models\HikingRoute;
use App\Models\User;
use App\Nova\Actions\DeleteHikingRouteAction;
use App\Nova\Actions\OsmSyncHikingRouteAction;
use App\Nova\Actions\RevertValidateHikingRouteAction;
use App\Nova\Actions\ValidateHikingRouteAction;
use App\Services\OsmService;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Collection;
use Laravel\Nova\Fields\ActionFields;
use Tests\TestCase;

class HikingRouteValidateTest extends TestCase
{
    use RefreshDatabase;

    private function fakerGeometryRawData(){
        return 'SRID=4326;LINESTRING(8.740102965384722 46.04144300334156 0,8.740072036162019 46.04137200862169 0,8.740095002576709 46.04133496060967 0,8.740202039480209 46.04125700891018 0,8.740208996459842 46.04125499725342 0,8.740532035008073 46.0411399975419 0,8.740907711908221 46.04099549353123 0,8.741103680804372 46.04079793207347 0,8.74110996723175 46.0407929867506 0,8.741104016080499 46.04074202477932 0,8.741256985813379 46.04043097235262 0,8.74141096137464 46.04006602428854 0,8.741597039625049 46.03978900238872 0,8.741971040144563 46.03957400657237 0,8.74201001599431 46.03941902518272 0,8.742226017639041 46.03923797607422 0,8.742307992652059 46.03910596109927 0,8.742322996258736 46.03903002105653 0,8.742337999865413 46.03901099413633 0,8.742345962673426 46.03875299915671 0,8.74241997487843 46.0385550186038 0,8.742531035095453 46.038500033319 0,8.742575962096453 46.03847899474204 0,8.74263203702867 46.03848896920681 0,8.742815013974905 46.03848402388394 0,8.742848038673401 46.03848997503519 0,8.742897994816303 46.03849299252033 0,8.742944011464715 46.03849399834871 0,8.743024980649352 46.03848301805556 0,8.743144003674388 46.03851897642016 0,8.743201000615954 46.03853699751198 0,8.743282975628972 46.03861603885889 0,8.743420019745827 46.03876498527825 0,8.743593022227287 46.03898802772164 0,8.743711961433291 46.03910696692765 0,8.74372998252511 46.03913202881813 0,8.743738029152155 46.03914300911129 0,8.743800977244973 46.03908902965486 0,8.743873983621597 46.03904996998608 0,8.743907008320093 46.03907796554267 0,8.743949001654983 46.03911300189793 0,8.743960987776518 46.0390819888562 0,8.743957970291376 46.03905600495636 0,8.743982026353478 46.03893497027457 0,8.74400700442493 46.03885500691831 0,8.743988983333111 46.03873196057975 0,8.744018990546465 46.03864897973835 0,8.744067018851638 46.03854303248227 0,8.744087973609567 46.03844999335706 0,8.744056960567832 46.03838201612234 0,8.744033994153142 46.03830498643219 0,8.744065007194877 46.03819099254906 0,8.744102977216244 46.03815201669931 0,8.744142036885023 46.03811798617244 0,8.744153017178178 46.03803399950266 0,8.74426600523293 46.03792897425592 0,8.744300035759807 46.03791003115475 0,8.744368012994528 46.03785102255642 0,8.744461974129081 46.03778396733105 0,8.744469014927745 46.03769201785326 0,8.744549984112382 46.03757500648499 0,8.744579991325736 46.03756201453507 0,8.7446319591254 46.03753703646362 0,8.744659032672644 46.03748297318816 0,8.744726004078984 46.03739999234676 0,8.744853995740414 46.03738197125494 0,8.744979975745082 46.03731198236346 0,8.745069997385144 46.0372219607234 0,8.745138980448246 46.03711903095245 0,8.745187008753419 46.03709698654711 0,8.745431005954742 46.03713101707399 0,8.745459001511335 46.03713797405362 0,8.745507029816508 46.03714903816581 0,8.745611971244216 46.03717996738851 0,8.745682965964079 46.0371910315007 0,8.745737029239535 46.03713101707399 0,8.745729988440871 46.03707603178918 0,8.745762007310987 46.03697402402759 0,8.745787991210818 46.03694301098585 0,8.745765024796128 46.03690797463059 0,8.745704004541039 46.03680102154613 0,8.745686989277601 46.03671996854246 0,8.745695035904646 46.03663899935782 0,8.745711967349052 46.03662198409438 0,8.745739040896297 46.03654797188938 0,8.745714984834194 46.03648200631142 0,8.745724959298968 46.03637899272144 0,8.745790002867579 46.03630799800158 0,8.745841970667243 46.03630104102194 0,8.745893016457558 46.03622199967504 0,8.74592000618577 46.03614203631878 0,8.746014973148704 46.03601102717221 0,8.746086973696947 46.03597096167505 0,8.746204990893602 46.03598202578723 0,8.746317978948355 46.03603198193014 0,8.746376987546682 46.03606098331511 0,8.746457034721971 46.03609903715551 0,8.746477989479899 46.0361080057919 0,8.746534986421466 46.0361169744283 0,8.746604975312948 46.03610398247838 0,8.746668007224798 46.03607296943665 0,8.746760040521622 46.03610498830676 0,8.746804967522621 46.03616802021861 0,8.746860958635807 46.03620003908873 0,8.746942011639476 46.03621495887637 0,8.747057011350989 46.03620699606836 0,8.747068997472525 46.03623297996819 0,8.747089030221105 46.03626097552478 0,8.747161030769348 46.03619400411844 0,8.747235964983702 46.0361169744283 0,8.747284999117255 46.03606198914349 0,8.747306037694216 46.03597096167505 0,8.747375020757318 46.03588697500527 0,8.747388012707233 46.03579896502197 0,8.747393041849136 46.03578496724367 0,8.747456995770335 46.0357800219208 0,8.747513992711902 46.0356920119375 0,8.747679032385349 46.03550501167774 0,8.747814986854792 46.03546201251447 0,8.747948007658124 46.03540099225938 0,8.748040962964296 46.03539302945137 0,8.748164009302855 46.03533301502466 0,8.74832896515727 46.03521097451448 0,8.748366013169289 46.03517702780664 0,8.748401971533895 46.03513796813786 0,8.748557958751917 46.03511902503669 0,8.748696008697152 46.03497703559697 0,8.74871201813221 46.03496102616191 0,8.74884101562202 46.03487201035023 0,8.749065985903144 46.03477201424539 0,8.749206969514489 46.03469096124172 0,8.749242005869746 46.03466296568513 0,8.749365974217653 46.03467201814055 0,8.749436968937516 46.03465097956359 0,8.749520033597946 46.03460303507745 0,8.749607959762216 46.03459096513689 0,8.749698987230659 46.03457403369248 0,8.749796971678734 46.03457696735859 0,8.749877018854022 46.03458501398563 0,8.749980032444 46.03459599427879 0,8.75002202577889 46.03460202924907 0,8.750125961378217 46.0345870256424 0,8.750270968303084 46.03455198928714 0,8.750387979671359 46.03454201482236 0,8.75047498382628 46.03448904119432 0,8.750505996868014 46.03447303175926 0,8.750657038763165 46.03448602370918 0,8.750790981575847 46.03449398651719 0,8.750928025692701 46.03449499234557 0,8.751093987375498 46.0344659909606 0,8.751228014007211 46.03442198596895 0,8.75124896876514 46.03438602760434 0,8.751346031203866 46.03433598764241 0,8.751365980133414 46.03431796655059 0,8.751467987895012 46.03434001095593 0,8.751520961523056 46.03438602760434 0,8.751692036166787 46.03436197154224 0,8.751880964264274 46.03436297737062 0,8.75208699144423 46.03433397598565 0,8.752383962273598 46.03434696793556 0,8.752446994185448 46.03436197154224 0,8.752578003332019 46.03440999984741 0,8.75262301415205 46.03442098014057 0,8.752745976671576 46.03449096903205 0,8.752829041332006 46.03451795876026 0,8.752984022721648 46.03456003591418 0,8.75320496968925 46.03458995930851 0,8.753341007977724 46.03457797318697 0,8.753375960513949 46.03458400815725 0,8.753456007689238 46.03458803147078 0,8.753479979932308 46.0345730278641 0,8.753529014065862 46.03448702953756 0,8.753608977422118 46.03441502898932 0,8.753794971853495 46.03434302844107 0,8.753906032070518 46.03432601317763 0,8.753988007083535 46.0343309585005 0,8.754111975431442 46.03431302122772 0,8.754250025376678 46.03428795933723 0,8.754280032590032 46.03427798487246 0,8.754336023703218 46.03425401262939 0,8.754438031464815 46.03421998210251 0,8.754554959014058 46.03418000042439 0,8.754712035879493 46.03408503346145 0,8.754943963140249 46.03402803651989 0,8.755056029185653 46.03401303291321 0,8.755198018625379 46.03397598490119 0,8.755314024165273 46.03395402431488 0,8.755432041361928 46.03390297852457 0,8.755520973354578 46.03381698019803 0,8.755581993609667 46.0337080154568 0,8.755639996379614 46.03363400325179 0,8.755730018019676 46.03354398161173 0,8.755768993869424 46.03347399272025 0,8.755814004689455 46.03339302353561 0,8.755758013576269 46.03330995887518 0,8.755702022463083 46.0332310013473 0,8.755677966400981 46.03312497027218 0,8.755632033571601 46.03306998498738 0,8.75558802857995 46.03301198221743 0,8.755579981952906 46.03299303911626 0,8.755572019144893 46.03294903412461 0,8.755517033860087 46.03287099860609 0,8.755518039688468 46.03283998556435 0,8.755490966141224 46.03279899805784 0,8.755452996119857 46.03275398723781 0,8.755340008065104 46.03275901637971 0,8.755302960053086 46.03277795948088 0,8.75524302944541 46.03279002942145 0,8.755089975893497 46.03277997113764 0,8.755054017528892 46.03276899084449 0,8.754930971190333 46.03277502581477 0,8.754688985645771 46.03276697918773 0,8.754591001197696 46.03277502581477 0,8.754572980105877 46.03276697918773 0,8.754422022029757 46.03276597335935 0,8.754126979038119 46.03270503692329 0,8.754060007631779 46.0326939728111 0,8.754009967669845 46.03266295976937 0,8.753819027915597 46.03260696865618 0,8.753644013777375 46.03257101029158 0,8.753600008785725 46.03255801834166 0,8.753518033772707 46.03253102861345 0,8.753430023789406 46.03252398781478 0,8.753385012969375 46.03253496810794 0,8.753342013806105 46.03252599947155 0,8.753323992714286 46.03251703083515 0,8.753263978287578 46.03252901695669 0,8.753222990781069 46.03255298919976 0,8.753150990232825 46.03252801112831 0,8.753117965534329 46.03251200169325 0,8.753019981086254 46.03250797837973 0,8.752996008843184 46.03252097032964 0,8.752926019951701 46.03249196894467 0,8.752870028838515 46.03244503028691 0,8.752808002755046 46.03238401003182 0,8.752730973064899 46.03234503418207 0,8.752715969458222 46.03233497589827 0,8.752670036628842 46.03229600004852 0,8.752647992223501 46.03228703141212 0,8.752538021653891 46.03224503807724 0,8.752359990030527 46.03216800838709 0,8.752234010025859 46.03213003836572 0,8.752124039456248 46.03214797563851 0,8.75191499479115 46.03212400339544 0,8.751862021163106 46.03212702088058 0,8.751639984548092 46.03206298314035 0,8.751539988443255 46.03200699202716 0,8.751382995396852 46.03199601173401 0,8.751123994588852 46.03190003894269 0,8.750916039571166 46.03179702535272 0,8.750813025981188 46.03173399344087 0,8.750630971044302 46.03166802786291 0,8.750465009361506 46.0315940156579 0,8.750314973294735 46.03141598403454 0,8.750321008265018 46.03129503317177 0,8.750394014641643 46.03119000792503 0,8.750484036281705 46.03113200515509 0,8.750509014353156 46.03109596297145 0,8.750547990202904 46.03104399517179 0,8.750419998541474 46.03095699101686 0,8.750300975516438 46.03087199851871 0,8.750287983566523 46.03082598187029 0,8.750454029068351 46.03076202794909 0,8.750637592747808 46.03074518032372 0,8.750767009332776 46.0307150054723 0,8.750859964638948 46.0306959785521 0,8.751004971563816 46.03066496551037 0,8.751225918531418 46.0306373052299 0,8.751380397006869 46.03057871572673 0,8.751555997878313 46.0305630415678 0,8.751596985384822 46.03058801963925 0,8.751735035330057 46.03063101880252 0,8.751833019778132 46.03064300492406 0,8.751909965649247 46.03063596412539 0,8.751912983134389 46.03060101158917 0,8.751988001167774 46.03054996579885 0,8.752056984230876 46.03051702491939 0,8.752116998657584 46.03052197024226 0,8.752132002264261 46.03051501326263 0,8.752097971737385 46.03043203242123 0,8.752076011151075 46.03037897497416 0,8.752109371125698 46.03020614013076 0,8.75218715518713 46.03010497055948 0,8.752302154898643 46.03002802468836 0,8.752380860969424 46.02998276241124 0,8.752427129074931 46.02996013127267 0,8.752527628093958 46.02989919483662 0,8.752655787393451 46.02983884513378 0,8.752805404365063 46.02975821122527 0,8.752847565338016 46.02972744964063 0,8.752875560894608 46.02970113046467 0,8.753026016056538 46.02960297837853 0,8.753098016604781 46.02951496839523 0,8.752986621111631 46.02945411577821 0,8.752957619726658 46.02943642996252 0,8.752928031608462 46.0293869767338 0,8.75309600494802 46.02928899228573 0,8.753278981894255 46.02936099283397 0,8.753415020182729 46.02937096729875 0,8.753447039052844 46.02936903946102 0,8.75358902849257 46.0293510183692 0,8.753745770081878 46.0292905010283 0,8.753801174461842 46.0292524471879 0,8.753751637414098 46.02910408750176 0,8.753681229427457 46.02903594262898 0,8.753673015162349 46.02900702506304 0,8.753645019605756 46.02895899675786 0,8.753609983250499 46.02888599038124 0,8.7536979932338 46.02877199649811 0,8.753743004053831 46.02874400094151 0,8.753827912732959 46.02872287854552 0,8.753980044275522 46.02880904451013 0,8.754092026501894 46.02878297679126 0,8.754137875512242 46.02868180721998 0,8.754078783094883 46.02847795933485 0,8.753986833617091 46.02832909673452 0,8.753822967410088 46.02819297462702 0,8.753904020413756 46.02816900238395 0,8.753961017355323 46.02818098850548 0,8.754207026213408 46.02825902402401 0,8.754332000389695 46.0283010173589 0,8.754533920437098 46.02836069650948 0,8.754789819940925 46.02831115946174 0,8.754970030859113 46.02819959633052 0,8.755100201815367 46.0281128436327 0,8.755273204296827 46.02794746868312 0,8.755437238141894 46.02777739986777 0,8.755596997216344 46.02750699967146 0,8.755714008584619 46.02727398276329 0,8.755909977480769 46.02706401608884 0,8.756055990234017 46.02684097364545 0,8.755988012999296 46.02660301141441 0,8.755883993580937 46.0264050308615 0,8.755849208682775 46.02637896314263 0,8.75578198581934 46.02634602226317 0,8.75537789426744 46.02631291374564 0,8.755147978663445 46.02632900699973 0,8.754887972027063 46.02632498368621 0,8.754808260127902 46.0263495426625 0,8.754641879349947 46.0265102237463 0,8.754441048949957 46.0265617724508 0,8.754259999841452 46.02661801502109 0,8.75419202260673 46.0267089586705 0,8.754163021221757 46.02677098475397 0,8.753868984058499 46.0267829708755 0,8.75378399156034 46.02678196504712 0,8.753373026847839 46.02678598836064 0,8.753249980509281 46.02678397670388 0,8.752995003014803 46.02680803276598 0,8.752968013286591 46.02681096643209 0,8.752880003303289 46.02682597003877 0,8.752729967236519 46.026890007779 0,8.752543972805142 46.02697198279202 0,8.752453029155731 46.02701598778367 0,8.752388991415501 46.02703903801739 0,8.752347249537706 46.02704641409218 0,8.752277595922351 46.02703291922808 0,8.751985486596823 46.02707449346781 0,8.751768982037902 46.02710156701505 0,8.751572007313371 46.02710902690887 0,8.751274030655622 46.02711598388851 0,8.75124704092741 46.02711698971689 0,8.75122600235045 46.02709301747382 0,8.751317029818892 46.02701699361205 0,8.751414008438587 46.02691398002207 0,8.751338990405202 46.02685295976698 0,8.751198006793857 46.02684902027249 0,8.751175962388515 46.02684700861573 0,8.751089964061975 46.02681498974562 0,8.751112008467317 46.02674902416766 0,8.751154001802206 46.02663896977901 0,8.751149978488684 46.02661600336432 0,8.751107985153794 46.02661097422242 0,8.751128017902374 46.02656898088753 0,8.751146038994193 46.02654702030122 0,8.751180991530418 46.02649698033929 0,8.751250980421901 46.02636496536434 0,8.75124704092741 46.02633101865649 0,8.751117959618568 46.02632397785783 0,8.75103103928268 46.0263170208782 0,8.751117959618568 46.02626396343112 0,8.751172022894025 46.02619699202478 0,8.75120303593576 46.0261460300535 0,8.751287022605538 46.02607796899974 0,8.751403028145432 46.02601896040142 0,8.751471005380154 46.02596699260175 0,8.75146396458149 46.02591603063047 0,8.751365980133414 46.02589197456837 0,8.751262966543436 46.02587202563882 0,8.751111002638936 46.02585199289024 0,8.750960966572165 46.0258400067687 0,8.750816965475678 46.02580103091896 0,8.750726021826267 46.02574202232063 0,8.750740019604564 46.02571402676404 0,8.750757034868002 46.025669015944 0,8.750870190560818 46.02559399791062 0,8.75098804011941 46.02551369927824 0,8.751022992655635 46.02547799237072 0,8.751153750345111 46.02533751167357 0,8.751097256317735 46.02502436377108 0,8.751142183318734 46.02493023499846 0,8.751232540234923 46.02474331855774 0,8.751290375366807 46.02460543625057 0,8.751347959041595 46.02439102716744 0,8.751343432813883 46.02433302439749 0,8.751374864950776 46.02429622784257 0,8.751448709517717 46.02426110766828 0,8.75155046582222 46.02419623173773 0,8.751604612916708 46.02416580542922 0,8.751736041158438 46.02409799583256 0,8.751877024769783 46.02405399084091 0,8.751984732225537 46.02405860088766 0,8.751992024481297 46.02387755177915 0,8.75203812494874 46.02385953068733 0,8.752062851563096 46.02384930476546 0,8.752125296741724 46.02383270859718 0,8.752157986164093 46.02382399141788 0,8.752380022779107 46.0238039586693 0,8.7524080183357 46.02373698726296 0,8.752425033599138 46.02370203472674 0,8.752498039975762 46.02361503057182 0,8.752498961985111 46.02360396645963 0,8.752511031925678 46.02344797924161 0,8.752478007227182 46.02339098230004 0,8.752443976700306 46.02329903282225 0,8.752392008900642 46.02324396371841 0,8.752434002235532 46.0232410300523 0,8.752481024712324 46.02323901839554 0,8.7525599822402 46.02322703227401 0,8.752470966428518 46.02321303449571 0,8.752398965880275 46.02318000979722 0,8.752399971708655 46.02310800924897 0,8.752395026385784 46.0230739787221 0,8.752356972545385 46.02301597595215 0,8.752354960888624 46.02298001758754 0,8.752384968101978 46.02294498123229 0,8.752389997243881 46.02291899733245 0,8.752493010833859 46.02294104173779 0,8.752540033310652 46.02298102341592 0,8.752594012767076 46.0230100248009 0,8.752713035792112 46.02300801314414 0,8.752744970843196 46.02294498123229 0,8.752775983884931 46.02294598706067 0,8.752878997474909 46.02291698567569 0,8.752919984981418 46.02294196374714 0,8.752976981922984 46.02293400093913 0,8.752992991358042 46.02290399372578 0,8.753011012449861 46.02288597263396 0,8.753041019663215 46.02290399372578 0,8.753087036311626 46.02289100177586 0,8.7531160376966 46.0228839609772 0,8.753149984404445 46.02289502508938 0,8.753207987174392 46.0229029878974 0,8.753197006881237 46.02283601649106 0,8.753170017153025 46.02276896126568 0,8.753090975806117 46.02271498180926 0,8.753146966919303 46.02263703010976 0,8.753180997446179 46.02262001484632 0,8.753192983567715 46.02260199375451 0,8.753226008266211 46.0225800331682 0,8.75322500243783 46.02256301790476 0,8.753284011036158 46.02251700125635 0,8.753338996320963 46.02244801819324 0,8.753359029069543 46.02244198322296 0,8.753383001312613 46.02235397323966 0,8.753423988819122 46.02234098128974 0,8.753474028781056 46.0223210323602 0,8.753597997128963 46.0222740098834 0,8.753658011555672 46.02230301126838 0,8.7536979932338 46.02235103957355 0,8.753786003217101 46.02239202708006 0,8.753825984895229 46.02240501902997 0,8.753925981000066 46.02241298183799 0,8.753962023183703 46.02242697961628 0,8.754037041217089 46.02248003706336 0,8.754117004573345 46.0224729962647 0,8.754182970151305 46.02244298905134 0,8.754238039255142 46.02242798544466 0,8.754314985126257 46.02248196490109 0,8.754411041736603 46.02253401651978 0,8.754470972344279 46.02253996767104 0,8.754510032013059 46.02254499681294 0,8.754620002582669 46.02252999320626 0,8.754673982039094 46.02245799265802 0,8.754780013114214 46.0222930368036 0,8.754840027540922 46.02227199822664 0,8.754981011152267 46.02229697629809 0,8.755026021972299 46.02234198711812 0,8.755104979500175 46.02234500460327 0,8.755118977278471 46.02229496464133 0,8.755109002813697 46.02226596325636 0,8.755061980336905 46.02221801877022 0,8.754990985617042 46.0221500415355 0,8.754958966746926 46.02209899574518 0,8.754877997562289 46.02205297909677 0,8.75481303781271 46.02202196605504 0,8.754779007285833 46.02200604043901 0,8.754741959273815 46.02200796827674 0,8.754663001745939 46.02195197716355 0,8.754771966487169 46.02189003489912 0,8.754818988963962 46.02188198827207 0,8.754883026704192 46.02184896357358 0,8.754929965361953 46.02185499854386 0,8.755020992830396 46.02183999493718 0,8.755089975893497 46.02184301242232 0,8.755189971998334 46.02186396718025 0,8.75537596642971 46.02191803045571 0,8.755498006939888 46.02196203544736 0,8.755531031638384 46.02197502739727 0,8.755553998053074 46.02199698798358 0,8.755612000823021 46.0220150090754 0,8.755711996927857 46.02200101129711 0,8.755844011902809 46.02206999436021 0,8.75591098330915 46.02206597104669 0,8.75593202188611 46.02206697687507 0,8.756081974133849 46.02207602933049 0,8.756220024079084 46.02208499796689 0,8.756363019347191 46.02212397381663 0,8.756440971046686 46.02212598547339 0,8.756498973816633 46.02216202765703 0,8.756542978808284 46.02220703847706 0,8.75661900267005 46.02222799323499 0,8.756670970469713 46.0221669729799 0,8.756723022088408 46.02215901017189 0,8.756760992109776 46.02215398102999 0,8.756785970181227 46.02215398102999 0,8.756935000419617 46.02215096354485 0,8.757030973210931 46.02217099629343 0,8.757058968767524 46.02215398102999 0,8.757129963487387 46.02214199490845 0,8.757186038419604 46.02215498685837 0,8.757325010374188 46.02216303348541 0,8.757425006479025 46.0221310146153 0,8.757609995082021 46.02215297520161 0,8.757733041420579 46.02214300073683 0,8.757837982848287 46.02212900295854 0,8.757901014760137 46.02212397381663 0,8.757989024743438 46.02210402488708 0,8.75803504139185 46.02208499796689 0,8.758158003911376 46.02208801545203 0,8.758247019723058 46.02206999436021 0,8.758307034149766 46.02202297188342 0,8.75844500027597 46.02196798659861 0,8.758503003045917 46.02192800492048 0,8.758548013865948 46.0219219699502 0,8.758630994707346 46.02191400714219 0,8.75878999941051 46.02192498743534 0,8.758881026878953 46.02190403267741 0,8.758956966921687 46.02186396718025 0,8.758994014933705 46.02184100076556 0,8.759050006046891 46.02177998051047 0,8.759062997996807 46.02174502797425 0,8.759073978289962 46.02172398939729 0,8.759094011038542 46.02161996997893 0,8.759152013808489 46.02158199995756 0,8.759285034611821 46.02158199995756 0,8.759501958265901 46.02158099412918 0,8.759663980454206 46.02154796943069 0,8.759729024022818 46.02157001383603 0,8.759791972115636 46.02157001383603 0,8.759837988764048 46.02157697081566 0,8.759995987638831 46.02163296192884 0,8.760264040902257 46.02172700688243 0,8.760309973731637 46.02173496969044 0,8.760389015078545 46.021673027426 0,8.760416004806757 46.02158702909946 0,8.760425979271531 46.02150203660131 0,8.760451963171363 46.02141100913286 0,8.76055296510458 46.02132903411984 0,8.760611973702908 46.02129399776459 0,8.76085102558136 46.02131000719965 0,8.76111002638936 46.02139600552619 0,8.761344971135259 46.02144797332585 0,8.76158201135695 46.02143598720431 0,8.761732969433069 46.02144998498261 0,8.761832965537906 46.02145501412451 0,8.761946959421039 46.02141000330448 0,8.762033963575959 46.02136398665607 0,8.76211903989315 46.02129098027945 0,8.76216203905642 46.02124898694456 0,8.76218500547111 46.02122996002436 0,8.762185843661427 46.02120137773454 0,8.762125493958592 46.02122141048312 0,8.76180530525744 46.02129047736526 0,8.76143541187048 46.02123783901334 0,8.761364920064807 46.02121948264539 0,8.761025788262486 46.02104731835425 0,8.760774834081531 46.02084749378264 0,8.760354481637478 46.02066971361637 0,8.759902194142342 46.02068345993757 0,8.758875578641891 46.02051456458867 0,8.758704252541065 46.02045463398099 0,8.758329497650266 46.02041993290186 0,8.758049122989178 46.02040031924844 0,8.757766904309392 46.0203952062875 0,8.757237000390887 46.02042831480503 0,8.756990237161517 46.02049620822072 0,8.756900634616613 46.02051506750286 0,8.756829220801592 46.0205315798521 0,8.756769960746169 46.02053359150887 0,8.756679184734821 46.02051498368382 0,8.756532585248351 46.02042831480503 0,8.756409203633666 46.02028716355562 0,8.756355056539178 46.02010955102742 0,8.75633904710412 46.02008147165179 0,8.756330665200949 46.02005590684712 0,8.756319768726826 46.02002833038568 0,8.756326893344522 46.01999865844846 0,8.756372826173902 46.01999161764979 0,8.756420854479074 46.01993805728853 0,8.756446251645684 46.01982180029154 0,8.756488747894764 46.01966137066483 0,8.756521437317133 46.01942650973797 0,8.75651347450912 46.01936389692128 0,8.756537949666381 46.01909098215401 0,8.756538033485413 46.01881798356771 0,8.756707012653351 46.01867599412799 0,8.756737019866705 46.01864196360111 0,8.75672796741128 46.01861698552966 0,8.756715981289744 46.01859301328659 0,8.756767027080059 46.01859401911497 0,8.756846990436316 46.01860801689327 0,8.756885966286063 46.01862603798509 0,8.756925025954843 46.01863198913634 0,8.756955033168197 46.01853903383017 0,8.75698302872479 46.01843400858343 0,8.756973976269364 46.01840500719845 0,8.75698403455317 46.01838296279311 0,8.757053017616272 46.01830098778009 0,8.757090987637639 46.01822798140347 0,8.757154019549489 46.01813200861216 0,8.757142033427954 46.01798197254539 0,8.757117977365851 46.01789396256208 0,8.757120994850993 46.01780402474105 0,8.757127029821277 46.01775599643588 0,8.757130969315767 46.01772498339415 0,8.757151002064347 46.01763102225959 0,8.757176985964179 46.01753002032638 0,8.757170028984547 46.01745097897947 0,8.757141027599573 46.01741099730134 0,8.757123006507754 46.01738099008799 0,8.756976993754506 46.01726498454809 0,8.756950004026294 46.01716700010002 0,8.756965007632971 46.01709499955177 0,8.75694002956152 46.01702299900353 0,8.756928965449333 46.01695502176881 0,8.756953021511436 46.0168209951371 0,8.756932988762856 46.01679501123726 0,8.75692100264132 46.01668202318251 0,8.756907004863024 46.01661798544228 0,8.756912034004927 46.01659099571407 0,8.756887977942824 46.01650600321591 0,8.756928965449333 46.01649401709437 0,8.756917985156178 46.0164650157094 0,8.756917985156178 46.01645001210272 0,8.756871968507767 46.01638798601925 0,8.756815977394581 46.01632998324931 0,8.756797034293413 46.01622403599322 0,8.756808014586568 46.01616603322327 0,8.75676903873682 46.0160849802196 0,8.756735008209944 46.01605899631977 0,8.756689997389913 46.01607701741159 0,8.756537027657032 46.01610199548304 0,8.756390009075403 46.01609998382628 0,8.756251959130168 46.01608900353312 0,8.756154980510473 46.01606503129005 0,8.756037969142199 46.01607802323997 0,8.755989018827677 46.01603200659156 0,8.755878964439034 46.01596000604331 0,8.755777040496469 46.0159139893949 0,8.755689030513167 46.01587300188839 0,8.755612000823021 46.01586596108973 0,8.755522985011339 46.01585498079658 0,8.755406979471445 46.01582103408873 0,8.755348976701498 46.01580100134015 0,8.75522400252521 46.01574199274182 0,8.755112020298839 46.01568600162864 0,8.755096010863781 46.01566999219358 0,8.754960978403687 46.01561299525201 0,8.754875985905528 46.01556496694684 0,8.754776995629072 46.01546295918524 0,8.754743970930576 46.01541300304234 0,8.754703989252448 46.01534896530211 0,8.754681022837758 46.01531200110912 0,8.754660990089178 46.01527000777423 0,8.754584966227412 46.0150820016861 0,8.754591001197696 46.01506196893752 0,8.754567028954625 46.01497395895422 0,8.754599969834089 46.01494101807475 0,8.754654033109546 46.01485602557659 0,8.754641963168979 46.01474496535957 0,8.754548002034426 46.01466701366007 0,8.754458986222744 46.01461999118328 0,8.754272991791368 46.01449602283537 0,8.754259999841452 46.01447096094489 0,8.754217000678182 46.01433500647545 0,8.75421398319304 46.01423400454223 0,8.754206020385027 46.01421698927879 0,8.754258994013071 46.01411296986043 0,8.754301993176341 46.01405496709049 0,8.754353038966656 46.01397701539099 0,8.754350021481514 46.01386402733624 0,8.754358990117908 46.01382597349584 0,8.754359995946288 46.0137450043112 0,8.75432001426816 46.01361097767949 0,8.754310961812735 46.01355196908116 0,8.754281038418412 46.01351299323142 0,8.754290007054806 46.01342498324811 0,8.754383968189359 46.01337603293359 0,8.754499973729253 46.01329003460705 0,8.754495028406382 46.01326103322208 0,8.754296964034438 46.01321300491691 0,8.753960011526942 46.01319900713861 0,8.753733029589057 46.01319003850222 0,8.753533959388733 46.0131720174104 0,8.753476962447166 46.01316296495497 0,8.753449972718954 46.01316003128886 0,8.753399010747671 46.01316497661173 0,8.753303037956357 46.01316497661173 0,8.753308989107609 46.0131199657917 0,8.75356019474566 46.01303614675999 0,8.753925981000066 46.01293103769422 0,8.753969985991716 46.01292802020907 0,8.754094960168004 46.01291703991592 0,8.754271985962987 46.01288996636868 0,8.754366030916572 46.0128799919039 0,8.754678424447775 46.01285601966083 0,8.754899874329567 46.0128699336201 0,8.75508083961904 46.01289315149188 0,8.755211429670453 46.01290262304246 0,8.755278903990984 46.01286792196333 0,8.75528703443706 46.01282081566751 0,8.755243699997663 46.01273900829256 0,8.755195001140237 46.01270003244281 0,8.755071870982647 46.01264429278672 0,8.754871878772974 46.01256558671594 0,8.754761908203363 46.0125327296555 0,8.754701390862465 46.01251873187721 0,8.754626037552953 46.01250666193664 0,8.75442361459136 46.01247539743781 0,8.754312554374337 46.01246634498239 0,8.754064282402396 46.0124603100121 0,8.753998400643468 46.01246315985918 0,8.753812992945313 46.01247196085751 0,8.753709979355335 46.01247296668589 0,8.753668991848826 46.01247497834265 0,8.753559021279216 46.01247003301978 0,8.753529014065862 46.01246600970626 0,8.753334889188409 46.01245058700442 0,8.753113020211458 46.01244002580643 0,8.753058034926653 46.01244396530092 0,8.752848487347364 46.01250154897571 0,8.752672215923667 46.01261520758271 0,8.75256241299212 46.01268293336034 0,8.752428302541375 46.01266985759139 0,8.75253114849329 46.01252820342779 0,8.752519832924008 46.01244673132896 0,8.752315817400813 46.0123363416642 0,8.752307016402483 46.01228496059775 0,8.752467026934028 46.01214397698641 0,8.752569034695625 46.01203802973032 0,8.75263181515038 46.0119856428355 0,8.752789981663227 46.01185999810696 0,8.752955021336675 46.01172002032399 0,8.753149984404445 46.01159244775772 0,8.753241011872888 46.011535031721 0,8.753488026559353 46.01137703284621 0,8.753547370433807 46.01130687631667 0,8.753390293568373 46.01118525490165 0,8.753078989684582 46.01111400872469 0,8.752736002206802 46.01102197542787 0,8.752533998340368 46.01090596988797 0,8.752525029703975 46.01089197210968 0,8.752589989453554 46.01071301847696 0,8.752611028030515 46.01069902069867 0,8.752733990550041 46.01054596714675 0,8.752839015796781 46.01034102961421 0,8.752713035792112 46.01018001325428 0,8.752529975026846 46.01015696302056 0,8.752450011670589 46.01017096079886 0,8.752210959792137 46.01025201380253 0,8.752152035012841 46.01032502017915 0,8.752056313678622 46.01040850393474 0,8.751909211277962 46.01041520945728 0,8.751824973151088 46.01030498743057 0,8.751751966774464 46.01012896746397 0,8.751694969832897 46.01001396775246 0,8.751474693417549 46.00982076488435 0,8.751062722876668 46.00968305021524 0,8.750883685424924 46.0096300765872 0,8.750588810071349 46.00953737273812 0,8.750426871702075 46.0094852373004 0,8.750246660783887 46.00941156037152 0,8.750094026327133 46.00916898809373 0,8.749952958896756 46.00893898867071 0,8.749833013862371 46.00874897092581 0,8.749694041907787 46.00851201452315 0,8.749547023326159 46.00824597291648 0,8.74954903498292 46.00788798183203 0,8.749546017497778 46.00761397741735 0,8.749562026932836 46.00731298327446 0,8.749541994184256 46.00705498829484 0,8.74945867806673 46.00684527307749 0,8.749418696388602 46.00677746348083 0,8.749336805194616 46.00665617734194 0,8.749302858486772 46.00661108270288 0,8.749172352254391 46.00645978935063 0,8.749082749709487 46.00639684125781 0,8.748880997300148 46.00624898448586 0,8.74864999204874 46.00608201697469 0,8.74864898622036 46.00588998757303 0,8.74850096181035 46.00579099729657 0,8.748472966253757 46.00577699951828 0,8.748302981257439 46.00567700341344 0,8.748167026787996 46.00540400482714 0,8.748114975169301 46.00532898679376 0,8.748092008754611 46.00524198263884 0,8.747978685423732 46.00518456660211 0,8.747795876115561 46.00507979281247 0,8.747623879462481 46.00499832071364 0,8.747395221143961 46.00481836125255 0,8.747326154261827 46.00464410148561 0,8.747259099036455 46.00454645231366 0,8.747162874788046 46.00442332215607 0,8.747041085734963 46.00426180288196 0,8.746972940862179 46.00412987172604 0,8.746897168457508 46.00398704409599 0,8.746840925887227 46.00379786454141 0,8.746855678036809 46.00366073660553 0,8.746876632794738 46.00344666279852 0,8.746679490432143 46.00330333225429 0,8.746500955894589 46.00319939665496 0,8.746295012533665 46.00306201726198 0,8.746197028085589 46.00310602225363 0,8.746117986738682 46.00309797562659 0,8.746041040867567 46.00312898866832 0,8.745981026440859 46.00323996506631 0,8.745916988700628 46.00335697643459 0,8.74581397511065 46.00349301472306 0,8.745782040059566 46.00351497530937 0,8.745739040896297 46.00349402055144 0,8.745488924905658 46.0034616664052 0,8.745279964059591 46.00338798947632 0,8.745173010975122 46.00334197282791 0,8.745055999606848 46.00332696922123 0,8.745052982121706 46.00320300087333 0,8.744961032643914 46.00302496924996 0,8.744879979640245 46.00300099700689 0,8.744754670187831 46.00299227982759 0,8.744437918066978 46.00307593122125 0,8.744013039395213 46.00320065394044 0,8.743838025256991 46.00324197672307 0,8.743540970608592 46.00336099974811 0,8.743431000038981 46.0034220200032 0,8.743067979812622 46.00354699417949 0,8.742959015071392 46.0035739839077 0)';
    }

    /**
     * @test
     */
    public function cant_validate_hiking_routes_if_geometry_check_is_false(){
        $user = User::factory()->create();
        $this->actingAs($user);
        $hr = HikingRoute::factory()->create();
        $hr->osm2cai_status = 3;
        $hr->geometry_check = false;
        $hr->geometry_raw_data = $this->fakerGeometryRawData();
        $hr->save();
        $action = new ValidateHikingRouteAction();
        $f = new ActionFields(Collection::make(),Collection::make());
        $res = $action->handle($f,Collection::make([0=>$hr]));
        $this->assertEquals('Geometry is not correct',$res['danger']);

    }

    /**
     * @test
     */
    public function can_validate_hiking_routes_if_geometry_check_is_false(){
        $user = User::factory()->create();
        $this->actingAs($user);
        $hr = HikingRoute::factory()->create();
        $hr->osm2cai_status = 3;
        $hr->geometry_check = true;
        $hr->geometry_raw_data = $this->fakerGeometryRawData();
        $hr->save();
        $action = new ValidateHikingRouteAction();
        $f = new ActionFields(Collection::make(),Collection::make());
        $res = $action->handle($f,Collection::make([0=>$hr]));
        $this->assertEquals($hr->id,$res['redirect']);
    }

    /**
     * @test
     */
    public function after_osmsync_data_validation_fields_are_null(){
        $user = User::factory()->create();
        $this->actingAs($user);
        $hr = HikingRoute::factory()->create();
        $hr->osm2cai_status = 4;
        $hr->validation_date = date('Y-m-d');
        $hr->geometry_check = true;
        $hr->geometry_raw_data = $this->fakerGeometryRawData();
        $hr->user_id = $user->id;
        $hr->relation_id = 9744403;
        $hr->save();
        $service = app()->make(OsmService::class);
        $service->updateHikingRouteModelWithOsmData($hr);
        $hr->fresh();
        $this->assertNull($hr->geometry_raw_data);
        $this->assertNull($hr->validation_date);
        $this->assertNull($hr->user_id);
        $this->assertEquals(3,$hr->osm2cai_status);
    }

    /**
     * @test
     */
    public function cant_revert_validate_where_sda_different_from_4(){
        $user = User::factory()->create();
        $this->actingAs($user);
        $hr = HikingRoute::factory()->create();
        $hr->osm2cai_status = 3;
        $hr->geometry_check = true;
        $hr->geometry_raw_data = $this->fakerGeometryRawData();
        $hr->user_id = $user->id;
        $hr->relation_id = 9744403;
        $hr->save();
        $action = new RevertValidateHikingRouteAction();
        $f = new ActionFields(Collection::make(),Collection::make());
        $res = $action->handle($f,Collection::make([0=>$hr]));
        $this->assertEquals('The SDA is not 4!',$res['danger']);
    }

    /**
     * @test
     */
    public function can_revert_validate_where_sda_is_4(){
        $user = User::factory()->create();
        $this->actingAs($user);
        $hr = HikingRoute::factory()->create();
        $hr->osm2cai_status = 4;
        $hr->validation_date = date('Y-m-d');
        $hr->user_id = $user->id;
        $hr->geometry_check = true;
        $hr->geometry_raw_data = $this->fakerGeometryRawData();
        $hr->relation_id = 9744403;
        $hr->save();
        $action = new RevertValidateHikingRouteAction();
        $f = new ActionFields(Collection::make(),Collection::make());
        $res = $action->handle($f,Collection::make([0=>$hr]));
        $this->assertEquals($hr->id,$res['redirect']);
        $hr->fresh();
        $this->assertEquals(3,$hr->osm2cai_status);
        $this->assertNull($hr->validation_date);
        $this->assertNull($hr->geometry_raw_data);
        $this->assertNull($hr->user_id);
    }


}
